<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Monitor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f9fafb;
        }
        h1 {
            text-align: center;
            width: 100%;
            margin: 20px 0;
            font-size: 2.5em;
            color: #333;
        }
        h3 {
            text-align: center;
            width: 100%;
            margin: 10px 0;
            font-size: 1.5em;
            color: #333;
}

        .container {
            display: flex;
            width: 90%;
            max-width: 1200px;
            justify-content: space-between;
            padding: 30px;
            background-color: #ffffff;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            margin-bottom: 40px;
        }
        .chart-container {
            width: 55%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .chart {
            border: 2px solid #ccc;
            width: 100%;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #007bff;
            font-size: 1.2em;
            border-radius: 10px;
            background-color: #fff;
            padding: 10px;
        }
        .history {
            border: 2px solid #ccc;
            width: 100%;
            height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background-color: #fff;
            position: relative;
            overflow-y: scroll;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        .history-label {
            position: absolute;
            top: -20px;
            left: 10px;
            background-color: #f0f2f5;
            padding: 0 5px;
        }
        .form-container {
            display: flex;
            flex-wrap: wrap;
            width: 41%;    
        }
        .form-container input {
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #d3d3d3;
            border-radius: 5px;
            width: 95%;
            font-size: 1rem;
        }
        .form-container .form-group {
            display: flex;
            flex-direction: column;
            width: 48%;
            margin: 1%;
        }
        .form-container .form-group-wide {
            width: 98%;
        }
        .form-container .form-group-last-row {
            width: 48%;
            margin: 1%;
        }
        .form-container input {
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        #sendButton {
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: #fff;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
            margin-top: 10px;
            width: 100%;
        }
        #sendButton:hover {
            background-color: #0056b3;
        }
        .start-stop-container {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        .start-stop-container button {
            padding: 10px 20px;
            border: none;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
            width: 48%;
        }
        .start-button {
            background-color: #28a745;
            color: #fff;
        }
        .start-button:hover {
            background-color: #218838;
        }
        .stop-button {
            background-color: #dc3545;
            color: #fff;
        }
        .stop-button:hover {
            background-color: #c82333;
        }
       /* Toggle button styles for Real-time Parameters Section */
       /* RTP Toggle button */
        .toggle-button {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            z-index: 1000;
            width: 40px;
            height: 120px;
        }
        .vertical-text {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-align: center;
        }
        /* Real-time Parameters Container */
        .real-time-parameters-container {
            position: absolute;
            right: 0;
            top: 100px;
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            display: none;
            width: 350px;
            z-index: 100;
            transition: opacity 0.3s ease;
        }
        /* Close button inside Real-time Parameters window */
        .close-rpt-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: red;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 1001;
        }
        /* Add hover effect for Close button */
        .close-rpt-btn:hover {
            background-color: darkred;
        }
        .real-time-parameters {
            width: 100%;
        }
        .real-time-parameters h2 {
            margin-top: 0;
            font-size: 1.5em;
            color: #333;
        }
        .parameter {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .parameter   {
            font-weight: bold;
            color: #333;
        }
        .parameter span {
            color: #007bff;
        }
        /* CSS for the new window and tabs */
        /* Modes Toggle button */
        /* Modes Toggle button */
        #toggleModesButton {
            position: absolute;
            right: 0; /* Align it with the RTP button */
            top: calc(50% + 140px); /* Offset it below the RTP button */
            background-color: #28a745; /* Give it a distinct color */
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            z-index: 1000;
            width: 40px;
            height: 120px;
        }
        .modes-container {
            position: absolute;
            left: 50%;  
            top: 50%;   
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            width: 550px;
            height: 500px;
            overflow: auto;
            resize: both; /* Enable resizing from corners */
            z-index: 100;
            cursor: move;
        }
        .tab-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
        }      
        .tab-content {
            display: flex;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        .tab-content.active {
            display: flex; /* Ensures that active content uses flex layout */
        }
        .tab-content .form-group {
            width: 49%; /* Ensures two columns */
            margin-right: 2%; /* Optional margin to separate the two columns */
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .tab-content .form-group-wide {
            width: 98%; /* Use only for specific inputs that need to stretch across both columns */
        }
        .tab-content .form-group:nth-child(2n) {
            margin-right: 0; /* Ensures that the right column doesn't have extra margin */
        }
        .close-modes-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: red;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        .close-modes-btn:hover {
            background-color: darkred;
        }

        .modes-input-group {
            width: 90%; /* Reduce the width to fit two groups in one row */
            margin-bottom: 0px;
            margin-left: auto;
            margin-right: auto;
        }

        .modes-input-group label {
            display: block;
            margin-bottom: 2px;
            font-weight: bold;
            width: 100%;
        }

        .modes-input-group input {
            width: 100%; /* Make inputs stretch to full width of the container */
            padding: 5px;
        }


        .input-group {
            margin-bottom: 0px;
        }

        .input-group label {
            display: block;
            margin-bottom: 1px;
            font-weight: bold;
            }

        .input-group input {
            width: 80%; /* Adjust based on your needs */
            padding: 4px;
            font-size: 14px;
            margin: 5px;
        }

        label {
            font-family: Arial, sans-serif; /* Replace with your desired font */
            font-size: 10px; /* Adjust font size if necessary */
            font-weight: bold; /* Optional: Make the font bold */
            position: relative;
            left: 5px;
        }



    </style>
</head>

<body>
    <h1>Car Monitor</h1>
    <div class="container">
        <div class="chart-container">
            <span id="kFps" style="float:right;"></span>
            <span id="LoopTime"></span>
            <div class="chart">
                <canvas id="chartCanvas"></canvas>
            </div>
            <div class="history">
                <span class="history-label">History of data sent</span>
                <i class="fas fa-trash" id="clearHistoryButton" style="cursor:pointer;float:right;margin-right:10px;color:red;"></i>
                <div id="history">
                <!-- History of sent data will appear here -->
                </div>
            </div>
                    <!-- Second Chart (RPM Chart) -->
            <div class="chart" style="position: relative;">
                <canvas id="rpmChartCanvas"></canvas>
                <!-- Left Wheel RPM Value (Top-left corner inside the RPM chart) -->
                <div id="leftWheelRPMDisplay" style="position: absolute; top: 10px; left: 10px; color: red; font-size: 16px; font-weight: bold;">
                    Left Wheel RPM: <span id="leftWheelRPM">0</span>
                </div>
                <!-- Right Wheel RPM Value (Top-right corner inside the RPM chart) -->
                <div id="rightWheelRPMDisplay" style="position: absolute; top: 10px; right: 10px; color: blue; font-size: 16px; font-weight: bold;">
                    Right Wheel RPM: <span id="rightWheelRPM">0</span>
                </div>
            </div>        
        </div>
        <div class="form-container">
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Enable Car Engine</label>
                    <input type="number" id="enable_car_engine">
                    <label for="inputId">Lookahead Min Distance (cm)</label>                    
                    <input type="number" id="lookahead_min_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Lookahead Max Distance (cm)</label>
                    <input type="number" id="lookahead_max_distance_cm" step="0.01">
                    <label for="inputId">Emergency Brake Distance (cm)</label>
                    <input type="number" id="emergency_break_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Min Speed</label>
                    <input type="number" id="min_speed" step="0.01">
                    <label for="inputId">Max Speed</label>
                    <input type="number" id="max_speed" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Lane Width Vector Unit Real</label>
                    <input type="number" id="lane_width_vector_unit_real" step="0.01">
                    <label for="inputId">Black Color Threshold</label>
                    <input type="number" id="black_color_treshold" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Enable Car Steering Wheel</label>
                    <input type="number" id="enable_car_steering_wheel">
                    <label for="inputId">Emergency Brake Min Speed</label>
                    <input type="number" id="emergency_brake_min_speed" step="0.01">
                </div>

            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Emergency Brake Distance from Obstacle (cm)</label>
                    <input type="number" id="emergency_brake_distance_from_obstacle_cm" step="0.01">
                    <label for="inputId">Enable Emergency Brake</label>
                    <input type="number" id="enable_emergency_brake">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">     
                    <label for="inputId">Enable Pixy Vector Approximation Soft</label>
                    <input type="number" id="enable_pixy_vector_approximation_soft">
                    <label for="inputId">Enable Distance Sensor 1 Soft</label>
                    <input type="number" id="enable_distance_sensor1_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Enable Distance Sensor 2 Soft</label>
                    <input type="number" id="enable_distance_sensor2_soft">
                    <label for="inputId">Enable Distance Sensor 3 Soft</label>
                    <input type="number" id="enable_distance_sensor3_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Emergency Brake Enable Delay</label>
                    <input type="number" id="emergency_brake_enable_delay" step="0.01">
                    <label for="inputId">Steering Wheel Angle Offset</label>
                    <input type="number" id="steering_wheel_angle_offset" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Max Speed after Emergency Brake Delay</label>
                    <input type="number" id="max_speed_after_emergency_brake_delay" step="0.01">
                    <label for="inputId">Min Axis Angle Vector</label>
                    <input type="number" id="min_axis_angle_vector" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Car Speed Ki</label>
                    <input type="number" id="car_speed_ki" step="0.01">
                    <label for="inputId">Car Speed Kd</label>
                    <input type="number" id="car_speed_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">enable finish line</label>
                    <input type="number" id="enable_finish_line_detection" step="0.01">
                    <label for="inputId">Car Speed Ki Min/Max Impact</label>
                    <input type="number" id="car_speed_ki_min_max_impact" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Finish Line Angle Tolerance</label>
                    <input type="number" id="finish_line_angle_tolerance" step="0.01">
                    <label for="inputId">Powertrain Left Wheel Kp</label>
                    <input type="number" id="powertrain_left_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Powertrain Left Wheel Ki</label>
                    <input type="number" id="powertrain_left_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain left Wheel Kd</label>
                    <input type="number" id="powertrain_left_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Powertrain Left Wheel Ki Max Sum</label>
                    <input type="number" id="powertrain_left_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">powertrain Right Wheel Kp</label>
                    <input type="number" id="powertrain_right_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Powertrain Right Wheel Ki</label>
                    <input type="number" id="powertrain_right_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain Right Wheel Kd</label>
                    <input type="number" id="powertrain_right_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Powertrain Right Wheel Ki Max Sum</label>
                    <input type="number" id="powertrain_right_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">Friction Coefficient</label>
                    <input type="number" id="friction_coefficient" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <label for="inputId">Downward Acceleration</label>
                    <input type="number" id="downward_acceleration" step="0.01">
                    <label for="inputId">Enable Remote Start/Stop Soft</label>
                    <input type="number" id="enable_remote_start_stop_soft">
                </div>
            </div>
            <div class="form-group">
                <label for="max_deceleration">Max Deceleration:</label>
                <span id="max_deceleration">0</span>
            </div>
            <div class="form-group">
                <label for="max_acceleration">Max Acceleration:</label>
                <span id="max_acceleration">0</span>
            </div>
            <button id="sendButton">Send</button>
            <div class="start-stop-container">
                <button class="start-button" id="startCarButton">Start the car (w)</button>
                <button class="stop-button" id="stopCarButton">Stop the car (s)</button>
            </div>
        </div>
    </div>

    <!-- Toggle button for Real-time Parameters Section -->
    <button class="toggle-button" id="toggleButton">
        <div class="vertical-text">RTP</div>
    </button>

    <!-- Toggle button for Modes Section -->
    <button class="toggle-button" id="toggleModesButton">
        <div class="vertical-text">Modes</div>
    </button>

    <!-- Modes Section Window -->
    <div class="modes-container" id="modesParams" style="display:none;">
        <!--    <div class="modes-header"></div>  This is the draggable header -->  
        <button class="close-modes-btn" id="closeModesButton">X</button>
        <h2>Modes</h2>
        <!-- Tab Buttons -->
        <div class="tab-buttons">
            <button id="debugTab" class="tab-button">Debug</button>
            <button id="raceTab" class="tab-button">Race</button>
            <button id="normalTab" class="tab-button">Normal</button>
        </div>

        <!-- Tab Content -->
        <div id="debugContent" class="tab-content">
            <h3>Debug Mode</h3>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Car Engine</label>
                    <input type="number" id="debug_enable_car_engine">
                    <label for="inputId">Lookahead Min Distance (cm)</label>                    
                    <input type="number" id="debug_lookahead_min_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Lookahead Max Distance (cm)</label>
                    <input type="number" id="debug_lookahead_max_distance_cm" step="0.01">
                    <label for="inputId">Emergency Brake Distance (cm)</label>
                    <input type="number" id="debug_emergency_break_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Min Speed</label>
                    <input type="number" id="debug_min_speed" step="0.01">
                    <label for="inputId">Max Speed</label>
                    <input type="number" id="debug_max_speed" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Lane Width Vector Unit Real</label>
                    <input type="number" id="debug_lane_width_vector_unit_real" step="0.01">
                    <label for="inputId">Black Color Threshold</label>
                    <input type="number" id="debug_black_color_treshold" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Car Steering Wheel</label>
                    <input type="number" id="debug_enable_car_steering_wheel">
                    <label for="inputId">Emergency Brake Min Speed</label>
                    <input type="number" id="debug_emergency_brake_min_speed" step="0.01">
                </div>

            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Emergency Brake Distance from Obstacle (cm)</label>
                    <input type="number" id="debug_emergency_brake_distance_from_obstacle_cm" step="0.01">
                    <label for="inputId">Enable Emergency Brake</label>
                    <input type="number" id="debug_enable_emergency_brake">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">     
                    <label for="inputId">Enable Pixy Vector Approximation Soft</label>
                    <input type="number" id="debug_enable_pixy_vector_approximation_soft">
                    <label for="inputId">Enable Distance Sensor 1 Soft</label>
                    <input type="number" id="debug_enable_distance_sensor1_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Distance Sensor 2 Soft</label>
                    <input type="number" id="debug_enable_distance_sensor2_soft">
                    <label for="inputId">Enable Distance Sensor 3 Soft</label>
                    <input type="number" id="debug_enable_distance_sensor3_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Emergency Brake Enable Delay</label>
                    <input type="number" id="debug_emergency_brake_enable_delay" step="0.01">
                    <label for="inputId">Steering Wheel Angle Offset</label>
                    <input type="number" id="debug_steering_wheel_angle_offset" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Max Speed after Emergency Brake Delay</label>
                    <input type="number" id="debug_max_speed_after_emergency_brake_delay" step="0.01">
                    <label for="inputId">Min Axis Angle Vector</label>
                    <input type="number" id="debug_min_axis_angle_vector" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Car Speed Ki</label>
                    <input type="number" id="debug_car_speed_ki" step="0.01">
                    <label for="inputId">Car Speed Kd</label>
                    <input type="number" id="debug_car_speed_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">enable finish line</label>
                    <input type="number" id="debug_enable_finish_line_detection" step="0.01">
                    <label for="inputId">Car Speed Ki Min/Max Impact</label>
                    <input type="number" id="debug_car_speed_ki_min_max_impact" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Finish Line Angle Tolerance</label>
                    <input type="number" id="debug_finish_line_angle_tolerance" step="0.01">
                    <label for="inputId">Powertrain Left Wheel Kp</label>
                    <input type="number" id="debug_powertrain_left_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Left Wheel Ki</label>
                    <input type="number" id="debug_powertrain_left_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain left Wheel Kd</label>
                    <input type="number" id="debug_powertrain_left_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Left Wheel Ki Max Sum</label>
                    <input type="number" id="debug_powertrain_left_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">powertrain Right Wheel Kp</label>
                    <input type="number" id="debug_powertrain_right_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Right Wheel Ki</label>
                    <input type="number" id="debug_powertrain_right_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain Right Wheel Kd</label>
                    <input type="number" id="debug_powertrain_right_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Right Wheel Ki Max Sum</label>
                    <input type="number" id="debug_powertrain_right_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">Friction Coefficient</label>
                    <input type="number" id="debug_friction_coefficient" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Downward Acceleration</label>
                    <input type="number" id="debug_downward_acceleration" step="0.01">
                    <label for="inputId">Enable Remote Start/Stop Soft</label>
                    <input type="number" id="debug_enable_remote_start_stop_soft">
                </div>
            </div>
            <div class="form-group">
                <label for="max_deceleration">Max Deceleration:</label>
                <span id="debug_max_deceleration">0</span>
            </div>
            <div class="form-group">
                <label for="max_acceleration">Max Acceleration:</label>
                <span id="debug_max_acceleration">0</span>
            </div>
            <button id="sendDebugButton">Send Debug</button>
            <button id="clearDebugButton">Clear Debug</button>
        </div>

        <div id="raceContent" class="tab-content" style="display:none;">
            <h3>Race Mode</h3>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Car Engine</label>
                    <input type="number" id="race_enable_car_engine">
                    <label for="inputId">Lookahead Min Distance (cm)</label>                    
                    <input type="number" id="race_lookahead_min_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Lookahead Max Distance (cm)</label>
                    <input type="number" id="race_lookahead_max_distance_cm" step="0.01">
                    <label for="inputId">Emergency Brake Distance (cm)</label>
                    <input type="number" id="race_emergency_break_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Min Speed</label>
                    <input type="number" id="race_min_speed" step="0.01">
                    <label for="inputId">Max Speed</label>
                    <input type="number" id="race_max_speed" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Lane Width Vector Unit Real</label>
                    <input type="number" id="race_lane_width_vector_unit_real" step="0.01">
                    <label for="inputId">Black Color Threshold</label>
                    <input type="number" id="race_black_color_treshold" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Car Steering Wheel</label>
                    <input type="number" id="race_enable_car_steering_wheel">
                    <label for="inputId">Emergency Brake Min Speed</label>
                    <input type="number" id="race_emergency_brake_min_speed" step="0.01">
                </div>

            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Emergency Brake Distance from Obstacle (cm)</label>
                    <input type="number" id="race_emergency_brake_distance_from_obstacle_cm" step="0.01">
                    <label for="inputId">Enable Emergency Brake</label>
                    <input type="number" id="race_enable_emergency_brake">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">     
                    <label for="inputId">Enable Pixy Vector Approximation Soft</label>
                    <input type="number" id="race_enable_pixy_vector_approximation_soft">
                    <label for="inputId">Enable Distance Sensor 1 Soft</label>
                    <input type="number" id="race_enable_distance_sensor1_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Distance Sensor 2 Soft</label>
                    <input type="number" id="race_enable_distance_sensor2_soft">
                    <label for="inputId">Enable Distance Sensor 3 Soft</label>
                    <input type="number" id="race_enable_distance_sensor3_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Emergency Brake Enable Delay</label>
                    <input type="number" id="race_emergency_brake_enable_delay" step="0.01">
                    <label for="inputId">Steering Wheel Angle Offset</label>
                    <input type="number" id="race_steering_wheel_angle_offset" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Max Speed after Emergency Brake Delay</label>
                    <input type="number" id="race_max_speed_after_emergency_brake_delay" step="0.01">
                    <label for="inputId">Min Axis Angle Vector</label>
                    <input type="number" id="race_min_axis_angle_vector" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Car Speed Ki</label>
                    <input type="number" id="race_car_speed_ki" step="0.01">
                    <label for="inputId">Car Speed Kd</label>
                    <input type="number" id="race_car_speed_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">enable finish line</label>
                    <input type="number" id="race_enable_finish_line_detection" step="0.01">
                    <label for="inputId">Car Speed Ki Min/Max Impact</label>
                    <input type="number" id="race_car_speed_ki_min_max_impact" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Finish Line Angle Tolerance</label>
                    <input type="number" id="race_finish_line_angle_tolerance" step="0.01">
                    <label for="inputId">Powertrain Left Wheel Kp</label>
                    <input type="number" id="race_powertrain_left_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Left Wheel Ki</label>
                    <input type="number" id="race_powertrain_left_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain left Wheel Kd</label>
                    <input type="number" id="race_powertrain_left_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Left Wheel Ki Max Sum</label>
                    <input type="number" id="race_powertrain_left_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">powertrain Right Wheel Kp</label>
                    <input type="number" id="race_powertrain_right_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Right Wheel Ki</label>
                    <input type="number" id="race_powertrain_right_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain Right Wheel Kd</label>
                    <input type="number" id="race_powertrain_right_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Right Wheel Ki Max Sum</label>
                    <input type="number" id="race_powertrain_right_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">Friction Coefficient</label>
                    <input type="number" id="race_friction_coefficient" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Downward Acceleration</label>
                    <input type="number" id="race_downward_acceleration" step="0.01">
                    <label for="inputId">Enable Remote Start/Stop Soft</label>
                    <input type="number" id="race_enable_remote_start_stop_soft">
                </div>
            </div>
            <div class="form-group">
                <label for="max_deceleration">Max Deceleration:</label>
                <span id="race_max_deceleration">0</span>
            </div>
            <div class="form-group">
                <label for="max_acceleration">Max Acceleration:</label>
                <span id="race_max_acceleration">0</span>
            </div>
            <button id="sendRaceButton">Send Race</button>
            <button id="clearRaceButton">Clear Race</button>
        </div>
    
        <div id="normalContent" class="tab-content" style="display:none;">
            <h3>Normal Mode</h3>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Car Engine</label>
                    <input type="number" id="normal_enable_car_engine">
                    <label for="inputId">Lookahead Min Distance (cm)</label>                    
                    <input type="number" id="normal_lookahead_min_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Lookahead Max Distance (cm)</label>
                    <input type="number" id="normal_lookahead_max_distance_cm" step="0.01">
                    <label for="inputId">Emergency Brake Distance (cm)</label>
                    <input type="number" id="normal_emergency_break_distance_cm" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Min Speed</label>
                    <input type="number" id="normal_min_speed" step="0.01">
                    <label for="inputId">Max Speed</label>
                    <input type="number" id="normal_max_speed" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Lane Width Vector Unit Real</label>
                    <input type="number" id="normal_lane_width_vector_unit_real" step="0.01">
                    <label for="inputId">Black Color Threshold</label>
                    <input type="number" id="normal_black_color_treshold" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Car Steering Wheel</label>
                    <input type="number" id="normal_enable_car_steering_wheel">
                    <label for="inputId">Emergency Brake Min Speed</label>
                    <input type="number" id="normal_emergency_brake_min_speed" step="0.01">
                </div>

            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Emergency Brake Distance from Obstacle (cm)</label>
                    <input type="number" id="normal_emergency_brake_distance_from_obstacle_cm" step="0.01">
                    <label for="inputId">Enable Emergency Brake</label>
                    <input type="number" id="normal_enable_emergency_brake">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">     
                    <label for="inputId">Enable Pixy Vector Approximation Soft</label>
                    <input type="number" id="normal_enable_pixy_vector_approximation_soft">
                    <label for="inputId">Enable Distance Sensor 1 Soft</label>
                    <input type="number" id="normal_enable_distance_sensor1_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Enable Distance Sensor 2 Soft</label>
                    <input type="number" id="normal_enable_distance_sensor2_soft">
                    <label for="inputId">Enable Distance Sensor 3 Soft</label>
                    <input type="number" id="normal_enable_distance_sensor3_soft">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Emergency Brake Enable Delay</label>
                    <input type="number" id="normal_emergency_brake_enable_delay" step="0.01">
                    <label for="inputId">Steering Wheel Angle Offset</label>
                    <input type="number" id="normal_steering_wheel_angle_offset" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Max Speed after Emergency Brake Delay</label>
                    <input type="number" id="normal_max_speed_after_emergency_brake_delay" step="0.01">
                    <label for="inputId">Min Axis Angle Vector</label>
                    <input type="number" id="normal_min_axis_angle_vector" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Car Speed Ki</label>
                    <input type="number" id="normal_car_speed_ki" step="0.01">
                    <label for="inputId">Car Speed Kd</label>
                    <input type="number" id="normal_car_speed_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">enable finish line</label>
                    <input type="number" id="normal_enable_finish_line_detection" step="0.01">
                    <label for="inputId">Car Speed Ki Min/Max Impact</label>
                    <input type="number" id="normal_car_speed_ki_min_max_impact" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Finish Line Angle Tolerance</label>
                    <input type="number" id="normal_finish_line_angle_tolerance" step="0.01">
                    <label for="inputId">Powertrain Left Wheel Kp</label>
                    <input type="number" id="normal_powertrain_left_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Left Wheel Ki</label>
                    <input type="number" id="normal_powertrain_left_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain left Wheel Kd</label>
                    <input type="number" id="normal_powertrain_left_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Left Wheel Ki Max Sum</label>
                    <input type="number" id="normal_powertrain_left_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">powertrain Right Wheel Kp</label>
                    <input type="number" id="normal_powertrain_right_wheel_kp" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Right Wheel Ki</label>
                    <input type="number" id="normal_powertrain_right_wheel_ki" step="0.01">
                    <label for="inputId">Powertrain Right Wheel Kd</label>
                    <input type="number" id="normal_powertrain_right_wheel_kd" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Powertrain Right Wheel Ki Max Sum</label>
                    <input type="number" id="normal_powertrain_right_wheel_ki_max_sum" step="0.01">
                    <label for="inputId">Friction Coefficient</label>
                    <input type="number" id="normal_friction_coefficient" step="0.01">
                </div>
            </div>
            <div class="form-group">
                <div class="modes-input-group">
                    <label for="inputId">Downward Acceleration</label>
                    <input type="number" id="normal_downward_acceleration" step="0.01">
                    <label for="inputId">Enable Remote Start/Stop Soft</label>
                    <input type="number" id="normal_enable_remote_start_stop_soft">
                </div>
            </div>
            <div class="form-group">
                <label for="max_deceleration">Max Deceleration:</label>
                <span id="normal_max_deceleration">0</span>
            </div>
            <div class="form-group">
                <label for="max_acceleration">Max Acceleration:</label>
                <span id="normal_max_acceleration">0</span>
            </div>
            <button id="sendNormalButton">Send Normal</button>
            <button id="clearNormalButton">Clear Normal</button>
        </div>
        <div class="resize-handle"></div> <!-- This is the handle for resizing -->
    </div>

    <!-- Real-time Parameters Section -->
    <div class="real-time-parameters-container" id="realTimeParams">
        <div class="real-time-parameters">
            <!-- Close button -->
            <button class="close-rpt-btn" id="closeRTPButton">X</button>
            <div class="real-time-parameters">
                <h2>Real-time Parameters</h2>
                <div class="parameter">
                    <div>Steering Angle:</div>
                    <span id="realTimeSteeringAngle">0</span>
                </div>
                <div class="parameter">
                    <div>Car Acceleration:</div>
                    <span id="realTimeCarAcceleration">0</span>
                </div>
                <div class="parameter">
                    <div>Front Obstacle Distance:</div>
                    <span id="realTimeFrontObstacleDistance">0</span>
                </div>
                <div class="parameter">
                    <div>Look Ahead Distance:</div>
                    <span id="realTimeLookAheadDistance">0</span>
                </div>
                <div class="parameter">
                    <div>Car Speed:</div>
                    <span id="realTimeCarSpeed">0</span>
                </div>
                <div class="parameter">
                    <div>Loop Time:</div>
                    <span id="realTimeLoopTime">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Script for functionality -->
    <script>
    
        //*VARIABLES**************************************

        // Handle the Modes Window
        const toggleModesButton = document.getElementById('toggleModesButton');
        const modesParams = document.getElementById('modesParams');
        const closeModesButton = document.getElementById('closeModesButton');

        let currentTab = null;// Mode window
        // Handle Tabs
        const debugTab = document.getElementById('debugTab');
        const raceTab = document.getElementById('raceTab');
        const normalTab = document.getElementById('normalTab');

        const debugContent = document.getElementById('debugContent');
        const raceContent = document.getElementById('raceContent');
        const normalContent = document.getElementById('normalContent');

        const carIPv4 = window.location.pathname.split('/').pop();
        let total_messages_recv = 0;
        let fps = 0;
        let fps_refresh_ms = 100;
        const ws = new WebSocket('ws://' + window.location.host + '/car-monitor/' + carIPv4);
        //const ws = new WebSocket(ws://localhost:3000/car-monitor/${carIPv4});
        
        const ctx = document.getElementById('chartCanvas').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                {
                        label: 'Left Line',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        data: [],
                        fill: false,
                    },
                    {
                        label: 'Right Line',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        data: [],
                        fill: false,
                    },
                    {
                        label: 'Middle Line',
                        borderColor: 'rgba(0, 0, 0, 1)', // Black color
                        backgroundColor: 'rgba(0, 0, 0, 0.2)',
                        data: [],
                        fill: false,
                    },
                    {
                        label: 'Left finish line',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        data: [],
                        fill: false,
                    },
                    {
                        label: 'Right finish line',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        data: [],
                        fill: false,
                    }
                ]
            },
            options: {
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom',
                        min: 0,
                        max: 78
                    },
                    y: {
                        min: 0,
                        max: 51
                    }
                },
                animation: false
            }
        });

        const kFps = document.getElementById('kFps');
        const LoopTime = document.getElementById('LoopTime');

        let lastUpdateTime = Date.now();
        const updateInterval = 50; // Update every 100ms

        let lastRpmUpdateTime = Date.now();
        const updateRpmInterval = 100;


        // Get the toggle button and real-time parameters section
        const toggleButton = document.getElementById('toggleButton');
        const realTimeParams = document.getElementById('realTimeParams');
        const closeRTPButton = document.getElementById('closeRTPButton');

        let lastOpenedTab = null;

        const rpmCtx = document.getElementById('rpmChartCanvas').getContext('2d');
        const rpmChart = new Chart(rpmCtx, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'Left Wheel RPM',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        data: [], // Initially empty, we'll add data over time
                        fill: false,
                    },
                    {
                        label: 'Right Wheel RPM',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        data: [],
                        fill: false,
                    }
                ]
            },
            options: {
                scales: {
                    x: {
                        display: false, // This hides the x-axis completely
                        // ///beginAtZero: true, // Start the x-axis at 0
                        type: 'linear',
                        // position: 'bottom',
                        // min: 0,
                        // max: 100, // This will change dynamically as new data comes in
                        // ticks: 
                        // {
                        //     autoSkip: true,
                        //     maxTicksLimit: 10  // Control how many x-axis ticks show
                        // }
  
                        
                    },
                    y: {
                        min: 0, // Assuming your RPM values fall in this range
                        max: 800
                    }
                },
                    // plugins: {
                    //     legend: {
                    //         display: true
                    //     }
                    // },
                elements: {
                    point: {
                        radius: 0, // Remove the circles
                        hoverRadius: 0 // Remove the hover effect on circles
                    }
                },
                animation: false
            }
        });

        const leftWheelRPM = document.getElementById('leftWheelRPM');
        const rightWheelRPM = document.getElementById('rightWheelRPM');

        //********************************** EVENTS LISTENERS ********************************************

        toggleModesButton.addEventListener('click', () => {
            modesParams.style.display = 'block';
            toggleModesButton.style.display = 'none';
        });

        closeModesButton.addEventListener('click', () => {
            modesParams.style.display = 'none';
            toggleModesButton.style.display = 'block';
        });

        debugTab.addEventListener('click', () => {
            showTab(debugContent);
        });

        raceTab.addEventListener('click', () => {
                showTab(raceContent);
            });

        normalTab.addEventListener('click', () => {
                showTab(normalContent);
            });

        // Attach event listeners to the buttons
        document.getElementById('debugTab').addEventListener('click', () => {
            toggleTab(document.getElementById('debugContent'), 'debugTab');
        });

        document.getElementById('raceTab').addEventListener('click', () => {
            toggleTab(document.getElementById('raceContent'), 'raceTab');
        });

        document.getElementById('normalTab').addEventListener('click', () => {
            toggleTab(document.getElementById('normalContent'), 'normalTab');
        });

        // Add listeners for sending data in each mode
        document.getElementById('sendDebugButton').addEventListener('click', () => {
            saveModeDataToLocalStorage('debug');
            const data = {
                param1: document.getElementById('debug_lane_width_vector_unit_real').value,
                param2: document.getElementById('debug_lookahead_min_distance_cm').value,
                param3: document.getElementById('debug_lookahead_max_distance_cm').value,
                param4: document.getElementById('debug_emergency_break_distance_cm').value,
                param5: document.getElementById('debug_min_speed').value,
                param6: document.getElementById('debug_max_speed').value,
                param7: document.getElementById('debug_black_color_treshold').value,
                param8: document.getElementById('debug_enable_car_engine').value,
                param9: document.getElementById('debug_enable_car_steering_wheel').value,
                param10: document.getElementById('debug_emergency_brake_min_speed').value,
                param11: document.getElementById('debug_emergency_brake_distance_from_obstacle_cm').value,
                param12: document.getElementById('debug_enable_emergency_brake').value,
                param13: document.getElementById('debug_enable_pixy_vector_approximation_soft').value,
                param14: document.getElementById('debug_enable_distance_sensor1_soft').value,
                param15: document.getElementById('debug_enable_distance_sensor2_soft').value,
                param16: document.getElementById('debug_emergency_brake_enable_delay').value,
                param17: document.getElementById('debug_steering_wheel_angle_offset').value,
                param18: document.getElementById('debug_enable_distance_sensor3_soft').value,
                param19: document.getElementById('debug_min_axis_angle_vector').value,
                param20: document.getElementById('debug_max_speed_after_emergency_brake_delay').value,
                param21: document.getElementById('debug_enable_remote_start_stop_soft').value,
                param22: document.getElementById('debug_car_speed_ki').value,
                param23: document.getElementById('debug_car_speed_kd').value,
                param24: document.getElementById('debug_enable_finish_line_detection').value,
                param25: document.getElementById('debug_car_speed_ki_min_max_impact').value,
                param26: document.getElementById('debug_finish_line_angle_tolerance').value,
                param27: document.getElementById('debug_powertrain_left_wheel_kp').value,
                param28: document.getElementById('debug_powertrain_left_wheel_ki').value,
                param29: document.getElementById('debug_powertrain_left_wheel_kd').value,
                param30: document.getElementById('debug_powertrain_left_wheel_ki_max_sum').value,
                param31: document.getElementById('debug_powertrain_right_wheel_kp').value,
                param32: document.getElementById('debug_powertrain_right_wheel_ki').value,
                param33: document.getElementById('debug_powertrain_right_wheel_kd').value,
                param34: document.getElementById('debug_powertrain_right_wheel_ki_max_sum').value,
                param35: document.getElementById('debug_friction_coefficient').value,
                param36: document.getElementById('debug_downward_acceleration').value,
                param37: parseFloat(document.getElementById('debug_max_acceleration').innerText),
                param38: parseFloat(document.getElementById('max_deceleration').innerText),
            };
            SendParametersToCar(ws, data);
        });

        document.getElementById('sendRaceButton').addEventListener('click', () => {
            saveModeDataToLocalStorage('race');
            const data = {
                param1: document.getElementById('race_lane_width_vector_unit_real').value,
                param2: document.getElementById('race_lookahead_min_distance_cm').value,
                param3: document.getElementById('race_lookahead_max_distance_cm').value,
                param4: document.getElementById('race_emergency_break_distance_cm').value,
                param5: document.getElementById('race_min_speed').value,
                param6: document.getElementById('race_max_speed').value,
                param7: document.getElementById('race_black_color_treshold').value,
                param8: document.getElementById('race_enable_car_engine').value,
                param9: document.getElementById('race_enable_car_steering_wheel').value,
                param10: document.getElementById('race_emergency_brake_min_speed').value,
                param11: document.getElementById('race_emergency_brake_distance_from_obstacle_cm').value,
                param12: document.getElementById('race_enable_emergency_brake').value,
                param13: document.getElementById('race_enable_pixy_vector_approximation_soft').value,
                param14: document.getElementById('race_enable_distance_sensor1_soft').value,
                param15: document.getElementById('race_enable_distance_sensor2_soft').value,
                param16: document.getElementById('race_emergency_brake_enable_delay').value,
                param17: document.getElementById('race_steering_wheel_angle_offset').value,
                param18: document.getElementById('race_enable_distance_sensor3_soft').value,
                param19: document.getElementById('race_min_axis_angle_vector').value,
                param20: document.getElementById('race_max_speed_after_emergency_brake_delay').value,
                param21: document.getElementById('race_enable_remote_start_stop_soft').value,
                param22: document.getElementById('race_car_speed_ki').value,
                param23: document.getElementById('race_car_speed_kd').value,
                param24: document.getElementById('race_enable_finish_line_detection').value,
                param25: document.getElementById('race_car_speed_ki_min_max_impact').value,
                param26: document.getElementById('race_finish_line_angle_tolerance').value,
                param27: document.getElementById('race_powertrain_left_wheel_kp').value,
                param28: document.getElementById('race_powertrain_left_wheel_ki').value,
                param29: document.getElementById('race_powertrain_left_wheel_kd').value,
                param30: document.getElementById('race_powertrain_left_wheel_ki_max_sum').value,
                param31: document.getElementById('race_powertrain_right_wheel_kp').value,
                param32: document.getElementById('race_powertrain_right_wheel_ki').value,
                param33: document.getElementById('race_powertrain_right_wheel_kd').value,
                param34: document.getElementById('race_powertrain_right_wheel_ki_max_sum').value,
                param35: document.getElementById('race_friction_coefficient').value,
                param36: document.getElementById('race_downward_acceleration').value,
                param37: parseFloat(document.getElementById('race_max_acceleration').innerText),
                param38: parseFloat(document.getElementById('race_max_deceleration').innerText),
            };
            SendParametersToCar(ws, data);
        });

        document.getElementById('sendNormalButton').addEventListener('click', () => {
            saveModeDataToLocalStorage('normal');
            const data = {
                param1: document.getElementById('normal_lane_width_vector_unit_real').value,
                param2: document.getElementById('normal_lookahead_min_distance_cm').value,
                param3: document.getElementById('normal_lookahead_max_distance_cm').value,
                param4: document.getElementById('normal_emergency_break_distance_cm').value,
                param5: document.getElementById('normal_min_speed').value,
                param6: document.getElementById('normal_max_speed').value,
                param7: document.getElementById('normal_black_color_treshold').value,
                param8: document.getElementById('normal_enable_car_engine').value,
                param9: document.getElementById('normal_enable_car_steering_wheel').value,
                param10: document.getElementById('normal_emergency_brake_min_speed').value,
                param11: document.getElementById('normal_emergency_brake_distance_from_obstacle_cm').value,
                param12: document.getElementById('normal_enable_emergency_brake').value,
                param13: document.getElementById('normal_enable_pixy_vector_approximation_soft').value,
                param14: document.getElementById('normal_enable_distance_sensor1_soft').value,
                param15: document.getElementById('normal_enable_distance_sensor2_soft').value,
                param16: document.getElementById('normal_emergency_brake_enable_delay').value,
                param17: document.getElementById('normal_steering_wheel_angle_offset').value,
                param18: document.getElementById('normal_enable_distance_sensor3_soft').value,
                param19: document.getElementById('normal_min_axis_angle_vector').value,
                param20: document.getElementById('normal_max_speed_after_emergency_brake_delay').value,
                param21: document.getElementById('normal_enable_remote_start_stop_soft').value,
                param22: document.getElementById('normal_car_speed_ki').value,
                param23: document.getElementById('normal_car_speed_kd').value,
                param24: document.getElementById('normal_enable_finish_line_detection').value,
                param25: document.getElementById('normal_car_speed_ki_min_max_impact').value,
                param26: document.getElementById('normal_finish_line_angle_tolerance').value,
                param27: document.getElementById('normal_powertrain_left_wheel_kp').value,
                param28: document.getElementById('normal_powertrain_left_wheel_ki').value,
                param29: document.getElementById('normal_powertrain_left_wheel_kd').value,
                param30: document.getElementById('normal_powertrain_left_wheel_ki_max_sum').value,
                param31: document.getElementById('normal_powertrain_right_wheel_kp').value,
                param32: document.getElementById('normal_powertrain_right_wheel_ki').value,
                param33: document.getElementById('normal_powertrain_right_wheel_kd').value,
                param34: document.getElementById('normal_powertrain_right_wheel_ki_max_sum').value,
                param35: document.getElementById('normal_friction_coefficient').value,
                param36: document.getElementById('normal_downward_acceleration').value,
                param37: parseFloat(document.getElementById('normal_max_acceleration').innerText),
                param38: parseFloat(document.getElementById('normal_max_deceleration').innerText),
            };
            SendParametersToCar(ws, data);
        });

        // Load stored data on page load
        window.addEventListener('load', () => {
            loadModeDataFromLocalStorage('debug');
            loadModeDataFromLocalStorage('race');
            loadModeDataFromLocalStorage('normal');
        });

        document.getElementById('sendButton').addEventListener('click', () => {
            const data = ReadAllCarParameters();
            SendParametersToCar(ws, data);

            // Add the sent data to the history with timestamp
            const historyDiv = document.getElementById('history');
            const newHistoryItem = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            newHistoryItem.innerHTML = `-------------------------------------------<br><strong>${timestamp}</strong><br>` + 
                Object.entries(data).map(([key, value]) => `${key}: ${value}`).join('<br><br>');
            
            historyDiv.insertBefore(newHistoryItem, historyDiv.firstChild);  // Insert at the top
        });

        document.getElementById('startCarButton').addEventListener('click', () => {
            let data = ReadAllCarParameters();
            data.enable_car_engine = '1';
            SendParametersToCar(ws, data);

            // Add the sent data to the history with timestamp
            const historyDiv = document.getElementById('history');
            const newHistoryItem = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            newHistoryItem.innerHTML = `-------------------------------------------<br><strong>${timestamp}</strong><br>` + 
                Object.entries(data).map(([key, value]) => `${key}: ${value}`).join('<br><br>');
            
            historyDiv.insertBefore(newHistoryItem, historyDiv.firstChild);  // Insert at the top
        });

        document.getElementById('stopCarButton').addEventListener('click', () => {
            let data = ReadAllCarParameters();
            data.enable_car_engine = '0';
            SendParametersToCar(ws, data);

            // Add the sent data to the history with timestamp
            const historyDiv = document.getElementById('history');
            const newHistoryItem = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            newHistoryItem.innerHTML = `-------------------------------------------<br><strong>${timestamp}</strong><br>` + 
                Object.entries(data).map(([key, value]) => `${key}: ${value}`).join('<br><br>');
            
            historyDiv.insertBefore(newHistoryItem, historyDiv.firstChild);  // Insert at the top
        });

        // Add a click listener to the trash bin icon to clear the history
        document.getElementById('clearHistoryButton').addEventListener('click', () => {
            const historyDiv = document.getElementById('history');
            historyDiv.innerHTML = ''; // Clear the history
            console.log('History cleared'); // Optional: Console log to show action is triggered
        });


        // Event listener for keyboard input to start the car
        document.addEventListener('keydown', (event) => {
            if (event.key === 'w') {
                let data = ReadAllCarParameters();
                data.enable_car_engine = '1';
                SendParametersToCar(ws, data);

                // Add the sent data to the history with timestamp
                const historyDiv = document.getElementById('history');
                const newHistoryItem = document.createElement('div');
                const timestamp = new Date().toLocaleTimeString();
                newHistoryItem.innerHTML = `-------------------------------------------<br><strong>${timestamp}</strong><br>` + 
                    Object.entries(data).map(([key, value]) => `${key}: ${value}`).join('<br><br>');
                
                historyDiv.insertBefore(newHistoryItem, historyDiv.firstChild);  // Insert at the top
            } else if (event.key === 's') {
                let data = ReadAllCarParameters();
                data.enable_car_engine = '0';
                SendParametersToCar(ws, data);

                // Add the sent data to the history with timestamp
                const historyDiv = document.getElementById('history');
                const newHistoryItem = document.createElement('div');
                const timestamp = new Date().toLocaleTimeString();
                newHistoryItem.innerHTML = `-------------------------------------------<br><strong>${timestamp}</strong><br>` + 
                    Object.entries(data).map(([key, value]) => `${key}: ${value}`).join('<br><br>');
                
                historyDiv.insertBefore(newHistoryItem, historyDiv.firstChild);  // Insert at the top
            }
        });

        // Add event listener for toggling the real-time parameters section
        toggleButton.addEventListener('click', () => {
            // Show the RTP window and hide the button
            realTimeParams.style.display = 'block';
            toggleButton.style.display = 'none';
        });

        // Close button inside the RTP window
        closeRTPButton.addEventListener('click', () => {
            // Hide the RTP window and show the toggle button again
            realTimeParams.style.display = 'none';
            toggleButton.style.display = 'block';
        });

        // Load data when the page is loaded
        window.addEventListener('load', loadDataFromLocalStorage);

        // Call the function to make the modes container draggable
        dragElement(document.getElementById("modesParams"));

        // Attach event listeners for the "Send" buttons to sync values to the form-container
        document.getElementById('sendDebugButton').addEventListener('click', () => {
            syncToFormContainer('debug');
            saveFormContainerData();  // Save after syncing from the mode
        });

        document.getElementById('sendRaceButton').addEventListener('click', () => {
            syncToFormContainer('race');
            saveFormContainerData();  // Save after syncing from the mode
        });

        document.getElementById('sendNormalButton').addEventListener('click', () => {
            syncToFormContainer('normal');
            saveFormContainerData();  // Save after syncing from the mode
        });

        // Load data for each mode when the user switches modes
        document.getElementById('debugTab').addEventListener('click', () => {
            trackLastSelectedMode('debug');
            loadModeDataFromLocalStorage('debug');
        });

        document.getElementById('raceTab').addEventListener('click', () => {
            trackLastSelectedMode('race');
            loadModeDataFromLocalStorage('race');
        });

        document.getElementById('normalTab').addEventListener('click', () => {
            trackLastSelectedMode('normal');
            loadModeDataFromLocalStorage('normal');
        });

        // Clear the inputs for Debug mode
        document.getElementById('clearDebugButton').addEventListener('click', () => {
            clearModeInputs('debug');
        });

        // Clear the inputs for Race mode
        document.getElementById('clearRaceButton').addEventListener('click', () => {
            clearModeInputs('race');
        });

        // Clear the inputs for Normal mode
        document.getElementById('clearNormalButton').addEventListener('click', () => {
            clearModeInputs('normal');
        });

// Load form-container values from localStorage when the page is loaded
window.addEventListener('load', () => {
    document.querySelectorAll('.form-container input').forEach(input => {
        const storedValue = localStorage.getItem(input.id);
        if (storedValue !== null) {
            input.value = storedValue;
        }
    });
});


        //************************************* FUNCTIONS ***************************************************

        function showTab(content) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            content.style.display = 'block';
        }

        function toggleTab(content, tabId) {
            // If the tab is already open, collapse it
            if (lastOpenedTab === tabId) {
                content.style.display = 'none'; // Collapse the content
                lastOpenedTab = null; // Reset last opened tab
            } else {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
                
                // Show the selected tab
                content.style.display = 'flex'; // Display in flex layout to ensure columns work
                lastOpenedTab = tabId; // Track the last opened tab
            }
        }
        
        // Function to track the last selected mode
        function trackLastSelectedMode(mode) {
            localStorage.setItem('lastSelectedMode', mode);  // Store the mode in localStorage
        }

        // Save and load values from localStorage
        function saveModeDataToLocalStorage(mode) {
            const inputs = document.querySelectorAll(`#${mode}Content input[type="number"]`);
            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });
        }

        function loadModeDataFromLocalStorage(mode) {
            const inputs = document.querySelectorAll(`#${mode}Content input[type="number"]`);
            inputs.forEach(input => {
                const storedValue = localStorage.getItem(input.id);
                if (storedValue !== null) {
                    input.value = storedValue;
                }
            });
        }
         
        function updateFps(){
            fps = (total_messages_recv / fps_refresh_ms)*1000;
            kFps.textContent = fps + " FPS";
            total_messages_recv = 0;
        }

        // Update the display every second
        setInterval(updateFps, fps_refresh_ms);

        function SendParametersToCar(websocket, parameters){
            // Convert data to CSV format
            const csvData = Object.values(parameters).join(';') + "\r\n";
            websocket.send(csvData);  // Send the CSV formatted data via WebSocket
        }

        function ReadAllCarParameters(){
            let data = {
                lane_width_vector_unit_real: document.getElementById('lane_width_vector_unit_real').value,
                lookahead_min_distance_cm: document.getElementById('lookahead_min_distance_cm').value,
                lookahead_max_distance_cm: document.getElementById('lookahead_max_distance_cm').value,
                emergency_break_distance_cm: document.getElementById('emergency_break_distance_cm').value,
                min_speed: document.getElementById('min_speed').value,
                max_speed: document.getElementById('max_speed').value,
                black_color_treshold: document.getElementById('black_color_treshold').value,
                enable_car_engine: document.getElementById('enable_car_engine').value,
                enable_car_steering_wheel: document.getElementById('enable_car_steering_wheel').value,
                emergency_brake_min_speed: document.getElementById('emergency_brake_min_speed').value,
                emergency_brake_distance_from_obstacle_cm: document.getElementById('emergency_brake_distance_from_obstacle_cm').value,
                enable_emergency_brake: document.getElementById('enable_emergency_brake').value,
                enable_pixy_vector_approximation_soft: document.getElementById('enable_pixy_vector_approximation_soft').value,
                enable_distance_sensor1_soft: document.getElementById('enable_distance_sensor1_soft').value,
                enable_distance_sensor2_soft: document.getElementById('enable_distance_sensor2_soft').value,
                emergency_brake_enable_delay: document.getElementById('emergency_brake_enable_delay').value,
                steering_wheel_angle_offset: document.getElementById('steering_wheel_angle_offset').value,
                enable_distance_sensor3_soft: document.getElementById('enable_distance_sensor3_soft').value,
                min_axis_angle_vector: document.getElementById('min_axis_angle_vector').value,
                max_speed_after_emergency_brake_delay: document.getElementById('max_speed_after_emergency_brake_delay').value,
                enable_remote_start_stop_soft: document.getElementById('enable_remote_start_stop_soft').value,
                car_speed_ki: document.getElementById('car_speed_ki').value,
                car_speed_kd: document.getElementById('car_speed_kd').value,
                car_speed_ki_min_max_impact: document.getElementById('car_speed_ki_min_max_impact').value,
                finish_line_angle_tolerance: document.getElementById('finish_line_angle_tolerance').value,
                enable_finish_line_detection: document.getElementById('enable_finish_line_detection').value,
                powertrain_left_wheel_kp: document.getElementById('powertrain_left_wheel_kp').value,
                powertrain_left_wheel_ki: document.getElementById('powertrain_left_wheel_ki').value,
                powertrain_left_wheel_kd: document.getElementById('powertrain_left_wheel_kd').value,
                powertrain_left_wheel_ki_max_sum: document.getElementById('powertrain_left_wheel_ki_max_sum').value,
                powertrain_right_wheel_kp: document.getElementById('powertrain_right_wheel_kp').value,
                powertrain_right_wheel_ki: document.getElementById('powertrain_right_wheel_ki').value,
                powertrain_right_wheel_kd: document.getElementById('powertrain_right_wheel_kd').value,
                powertrain_right_wheel_ki_max_sum: document.getElementById('powertrain_right_wheel_ki_max_sum').value,
                friction_coefficient: document.getElementById('friction_coefficient').value,
                downward_acceleration: document.getElementById('downward_acceleration').value,
                max_acceleration: parseFloat(document.getElementById('max_acceleration').innerText),
                max_deceleration: parseFloat(document.getElementById('max_deceleration').innerText),
            };
            return data;
        }

        function ParseCarDataToJSON(raw_data){
            //-60,-60,-30,-30; 30,-60,60,-30; -60,-60,-30,-30; 30,-60,60,-30; -1.0,1.0,10.0; 1.0,-1.0,-50.0;
            //-15,-60,15,-30; -45,-45,-35,-45; 35,-45,45,-45; -0.05; 1.0; 100.0; 60.0; 120.0; 1; -40,-45,-35,-45;
            //35,-45,40,-45; 1; 24.00; +6 more

            let parsedData = {};
            try {
                if (raw_data[0] === '%') {
                    return parsedData;
                }
                let tempField;
                const fields = raw_data.split(';');
                console.log('Fields:', fields);

                if (fields.length >= 19) {
                    tempField = fields[0].split(',').map(Number);
                    parsedData.leftVectorOld = [{ x: tempField[0], y: tempField[1] },
                                                { x: tempField[2], y: tempField[3] }];

                    tempField = fields[1].split(',').map(Number);
                    parsedData.rightVectorOld = [{ x: tempField[0], y: tempField[1] },
                                                 { x: tempField[2], y: tempField[3] }];
                    
                    tempField = fields[2].split(',').map(Number);
                    parsedData.leftVector = [{ x: tempField[0], y: tempField[1] },
                                             { x: tempField[2], y: tempField[3] }];
                
                    tempField = fields[3].split(',').map(Number);
                    parsedData.rightVector = [{ x: tempField[0], y: tempField[1] },
                                              { x: tempField[2], y: tempField[3] }];
                
                    tempField = fields[4].split(',').map(Number);
                    parsedData.leftLine = { a: tempField[0], b: tempField[1], c: tempField[2] };
                
                    tempField = fields[5].split(',').map(Number);
                    parsedData.rightLine = { a: tempField[0], b: tempField[1], c: tempField[2] };

                    tempField = fields[6].split(',').map(Number);
                    parsedData.laneMiddleLine = [{ x: tempField[0], y: tempField[1] },
                                                 { x: tempField[2], y: tempField[3] }];

                    tempField = fields[7].split(',').map(Number);
                    parsedData.carPos = { x: tempField[0], y: tempField[1] };

                    tempField = fields[8].split(',').map(Number);
                    parsedData.nextWayPoint = { x: tempField[0], y: tempField[1] };

                    parsedData.steeringAngle = Number(fields[9]);   // degrees
                    parsedData.carAcceleration = Number(fields[10]);     // percentual
                    parsedData.frontObstacleDistance = Number(fields[11]);   // cm
                    parsedData.lookAheadDistance = Number(fields[12]);       // cm
                    parsedData.carSpeed = Number(fields[13]);                // raw
                    parsedData.finish_line_detected = Number(fields[14]);    // boolean 1/0

                    tempField = fields[15].split(',').map(Number);
                    parsedData.finish_line_left = [{ x: tempField[0], y: tempField[1] },
                                                   { x: tempField[2], y: tempField[3] }];

                    tempField = fields[16].split(',').map(Number);
                    parsedData.finish_line_right = [{ x: tempField[0], y: tempField[1] },
                                                    { x: tempField[2], y: tempField[3] }];
                    
                    parsedData.finish_line_detected_now = Number(fields[17]);   // boolean 1/0
                    parsedData.loop_time = Number(fields[18]);   // ms
                    parsedData.left_wheel_raw_rpm = Number(fields[19]);
                    parsedData.left_wheel_adjusted_rpm = Number(fields[20]);
                    parsedData.right_wheel_raw_rpm = Number(fields[21]);
                    parsedData.right_wheel_adjusted_rpm = Number(fields[22]);
                    parsedData.left_wheel_speed_request_raw = Number(fields[23]);
                    parsedData.right_wheel_speed_request_raw = Number(fields[24]);
                } else {
                    console.error('Insufficient fields:', fields);
                }
            } catch (error) {
                console.error('Error parsing data:', error, 'Raw data:', raw_data);
            }
            return parsedData;
        }

        function updateChart(data) {
            if (Object.keys(data).length === 0) {
                return;
            }
            chart.data.datasets[0].data = data.leftVector;
            chart.data.datasets[1].data = data.rightVector;
            chart.data.datasets[2].data = data.laneMiddleLine;
            chart.data.datasets[3].data = data.finish_line_left;
            chart.data.datasets[4].data = data.finish_line_right;
            LoopTime.textContent = "Loop time [ms]:" + data.loop_time;
            chart.update();

            // Update real-time parameters
            document.getElementById('realTimeSteeringAngle').textContent = data.steeringAngle;
            document.getElementById('realTimeCarAcceleration').textContent = data.carAcceleration;
            document.getElementById('realTimeFrontObstacleDistance').textContent = data.frontObstacleDistance;
            document.getElementById('realTimeLookAheadDistance').textContent = data.lookAheadDistance;
            document.getElementById('realTimeCarSpeed').textContent = data.carSpeed;
            document.getElementById('realTimeLoopTime').textContent = data.loop_time;
        }

        ws.onerror = function(event) {
            console.error('WebSocket error:', event);
        };

        // ws.onmessage = function(event) {
        //     total_messages_recv += 1;
        //     //console.log('Message received:', event.data);  // Log the received data
        //     const data = ParseCarDataToJSON(event.data);
        //     //console.log('Parsed data:', data);  // Log the parsed data
        //     updateChart(data);
        // };

        ws.onmessage = function(event) {
            //const currentTime = Date.now();
            //if (currentTime - lastUpdateTime > updateInterval) {//We make this to not get to many message from the car
            const data = ParseCarDataToJSON(event.data);
            const leftRPM = data.left_wheel_rpm;   // Use the correct field for left RPM
            const rightRPM = data.right_wheel_rpm; // Use the correct field for right RPM
            updateChart(data); // This function updates the UI with new values
            updateRpmChart(data.left_wheel_adjusted_rpm, data.right_wheel_adjusted_rpm);
            //lastUpdateTime = currentTime;
            total_messages_recv += 1;
           //}
};

        // Function to save form data into localStorage
        function saveDataToLocalStorage() {
            let inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });
        }

        // Function to load form data from localStorage
        function loadDataFromLocalStorage() {
            let inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                let storedValue = localStorage.getItem(input.id);
                if (storedValue !== null) {
                    input.value = storedValue;
                }
            });
        }

        // Add event listeners to save data when user types
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', saveDataToLocalStorage);
        });

        function dragElement(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            if (document.getElementById(element.id + "Header")) {
                document.getElementById(element.id + "Header").onmousedown = dragMouseDown;
            } else {
                element.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                // Prevent dragging if the target is an input element
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') {
                    return;
                }
        
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + "px";
                element.style.left = (element.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // Function to sync data from the mode inputs to the main form-container
        function syncToFormContainer(mode) {
            //let modePrefix = mode; // e.g., 'debug', 'race', 'normal'

            // Sync each mode input to the corresponding form-container input
            document.querySelectorAll(`#${mode}Content input`).forEach((modeInput) => {
                let mainInputId = modeInput.id.replace(`${mode}_`, ''); // Remove the mode prefix
                let mainInput = document.getElementById(mainInputId);    // Get the main form input without the prefix

                if (mainInput) {  // Check if the main input exists
                    mainInput.value = modeInput.value;  // Sync the value
                } else {
                    console.warn(`Input with ID ${mainInputId} not found in form-container.`);
                }
            });
        }

        // Save form-container inputs to localStorage whenever they change
        document.querySelectorAll('.form-container input').forEach(input => {
            input.addEventListener('input', () => {
                localStorage.setItem(input.id, input.value);
            });
        });

        // Load form-container values from localStorage when the page is loaded
        window.addEventListener('load', () => {
            document.querySelectorAll('.form-container input').forEach(input => {
                const storedValue = localStorage.getItem(input.id);
                if (storedValue !== null) {
                    input.value = storedValue;
                }
            });
        });

        // Function to save the form-container data after sending mode data
        function saveFormContainerData() {
            const inputs = document.querySelectorAll('.form-container input');
            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value);
            });
        }



        // Save data to localStorage for each mode
        function saveModeDataToLocalStorage(mode) {
            let inputs = document.querySelectorAll(`#${mode}Content input`);

            inputs.forEach(input => {
                localStorage.setItem(input.id, input.value); // Save with the prefixed ID (e.g., 'normal_Speed')
            });
        }


        // Load saved data from localStorage when switching to a mode
        function loadModeDataFromLocalStorage(mode) {
            let inputs = document.querySelectorAll(`#${mode}Content input[type="number"]`);
            inputs.forEach(input => {
                let savedValue = localStorage.getItem(input.id);
                if (savedValue !== null) {
                    input.value = savedValue;
                }
            });
        }

        // Function to clear the inputs of a specific mode
        function clearModeInputs(mode) {
            const inputs = document.querySelectorAll(`#${mode}Content input[type="number"]`);
            inputs.forEach(input => {
                input.value = ''; // Clear the input value
                localStorage.removeItem(input.id); // Remove the value from localStorage
            });
        }

        //When new data comes from the car (via WebSocket or other means), you can update the 
        //chart dynamically by pushing the new RPM data to the datasets and adjusting the X-axis (time).
        function updateRpmChart(leftRpm, rightRpm) {
            const currentTime = Date.now(); // Use time or another metric for X-axis
            
            if (currentTime - lastRpmUpdateTime > updateRpmInterval){
                leftWheelRPM.textContent = leftRpm;
                rightWheelRPM.textContent = rightRpm;
            //     lastRpmUpdateTime = currentTime;
            // }

            // Add new data points with an x value that progresses
            rpmChart.data.datasets[0].data.push({ x: currentTime, y: leftRpm });
            rpmChart.data.datasets[1].data.push({ x: currentTime, y: rightRpm });
            
            // Remove old data to simulate scrolling (keep the last 100 data points)
            if (rpmChart.data.datasets[0].data.length > 100) {
                rpmChart.data.datasets[0].data.shift();
                rpmChart.data.datasets[1].data.shift();
            }
            // Make sure the chart's x-axis keeps expanding as new data is added
            rpmChart.options.scales.x.min = rpmChart.data.datasets[0].data[0].x;  // Start at the first data point
            rpmChart.options.scales.x.max = currentTime;  // End at the most recent point

            rpmChart.update();
            lastRpmUpdateTime = currentTime;
        }
        }

        //Wherever you receive the wheel RPM data from the car (e.g., in your WebSocket message 
        //handler or data parsing function), call the updateRpmChart() function and pass the left 
        //and right RPM values to it.
        function handleCarData(data) {
            // Assuming the parsed data includes the wheel RPM values
            const leftRpm = data.left_wheel_adjusted_rpm;
            const rightRpm = data.right_wheel_adjusted_rpm;
            
            // Update the RPM chart
            updateRpmChart(leftRpm, rightRpm);
        }


        function update_max_acc_dec() {
            const g_friction_coefficient = parseFloat(document.getElementById('friction_coefficient').value) || 0;
            const g_downward_acceleration = parseFloat(document.getElementById('downward_acceleration').value) || 0;

            const g_max_acceleration = g_friction_coefficient * g_downward_acceleration;
            const g_max_deceleration = g_max_acceleration - 100;

            document.getElementById('max_acceleration').innerText = g_max_acceleration.toFixed(4);
            document.getElementById('max_deceleration').innerText = g_max_deceleration.toFixed(4);
        }

        // Trigger the update_max_acc_dec function whenever the relevant inputs change
        document.getElementById('friction_coefficient').addEventListener('input', update_max_acc_dec);
        document.getElementById('downward_acceleration').addEventListener('input', update_max_acc_dec);


        function update_normal_max_acc_dec() {
            const g_friction_coefficient = parseFloat(document.getElementById('normal_friction_coefficient').value) || 0;
            const g_downward_acceleration = parseFloat(document.getElementById('normal_downward_acceleration').value) || 0;

            const g_max_acceleration = g_friction_coefficient * g_downward_acceleration;
            const g_max_deceleration = g_max_acceleration - 100;

            document.getElementById('normal_max_acceleration').innerText = g_max_acceleration.toFixed(4);
            document.getElementById('normal_max_deceleration').innerText = g_max_deceleration.toFixed(4);
        }

        // Trigger the update_normal_max_acc_dec function whenever the relevant inputs change
        document.getElementById('normal_friction_coefficient').addEventListener('input', update_normal_max_acc_dec);
        document.getElementById('normal_downward_acceleration').addEventListener('input', update_normal_max_acc_dec);


        function update_debug_max_acc_dec() {
            const g_friction_coefficient = parseFloat(document.getElementById('debug_friction_coefficient').value) || 0;
            const g_downward_acceleration = parseFloat(document.getElementById('debug_downward_acceleration').value) || 0;

            const g_max_acceleration = g_friction_coefficient * g_downward_acceleration;
            const g_max_deceleration = g_max_acceleration - 100;

            document.getElementById('debug_max_acceleration').innerText = g_max_acceleration.toFixed(4);
            document.getElementById('debug_max_deceleration').innerText = g_max_deceleration.toFixed(4);
        }

        // Trigger the update_debug_max_acc_dec function whenever the relevant inputs change
        document.getElementById('debug_friction_coefficient').addEventListener('input', update_debug_max_acc_dec);
        document.getElementById('debug_downward_acceleration').addEventListener('input', update_debug_max_acc_dec);


        function update_race_max_acc_dec() {
            const g_friction_coefficient = parseFloat(document.getElementById('race_friction_coefficient').value) || 0;
            const g_downward_acceleration = parseFloat(document.getElementById('race_downward_acceleration').value) || 0;

            const g_max_acceleration = g_friction_coefficient * g_downward_acceleration;
            const g_max_deceleration = g_max_acceleration - 100;

            document.getElementById('race_max_acceleration').innerText = g_max_acceleration.toFixed(4);
            document.getElementById('race_max_deceleration').innerText = g_max_deceleration.toFixed(4);
        }

        // Trigger the update_race_max_acc_dec function whenever the relevant inputs change
        document.getElementById('race_friction_coefficient').addEventListener('input', update_race_max_acc_dec);
        document.getElementById('race_downward_acceleration').addEventListener('input', update_race_max_acc_dec);
    </script>
</body>
</html>